(function(){"use strict";var e={8490:function(e,t,n){var o=n(5130),i=n(6768);function a(e,t,n,o,a,r){const s=(0,i.g2)("BottomLayer");return(0,i.uX)(),(0,i.Wv)(s)}n(4114),n(8111),n(7588);var r=n(144),s=n(8371),c=(n(1701),n(8776)),l=n(3191);class u{createCamera(e,t){const n=e.x/e.y,o=10,i=new s.qUd(o*n/-2,o*n/2,o/2,o/-2,.1,1e3);return i.position.set(t.x,t.y,t.z),i.lookAt(0,0,0),i}createRenderer(e){const t=new c.JeP({antialias:!0,alpha:!0});return t.setSize(e.x,e.y),t.shadowMap.enabled=!0,t.shadowMap.type=s.Wk7,t}addLight(e){const t=new s.$p8(13421772,.2);e.add(t);const n=new s.ZyN(16777215,1.25);n.position.set(-1.25,5.5,5),n.lookAt(0,0,0),n.castShadow=!0,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,n.shadow.camera.left=-12,n.shadow.camera.right=12,n.shadow.camera.top=12,n.shadow.camera.bottom=-12,n.shadow.camera.near=1,n.shadow.camera.far=30,e.add(n);const o=new s.ZyN(16777215,.35);o.position.set(2.5,5.5,-2.5),o.lookAt(0,0,0),e.add(o)}createFBX(e,t){return new Promise((n,o)=>{const i=new l.w,a=new s.Tap,r=a.load("./model/basetexture.jpg"),c=a.load("./model/floortexture.jpg"),u=a.load("./model/unchangetexture.jpg");i.load("./model/Area_"+e+".fbx",o=>{o.traverse(e=>{if(e.castShadow=!0,e.receiveShadow=!0,e instanceof s.eaF){const t=Array.isArray(e.material)?e.material:[e.material],n=t.map(e=>"lambert1"===e.name?new s._4j({color:16777215,map:c}):"lambert2"===e.name?new s._4j({map:u}):new s._4j({color:16777215,map:r}));e.material=Array.isArray(e.material)?n:n[0]}}),o.position.set(t.x,t.y,t.z);const i=.075;o.scale.set(i,i,i),o.userData.type=e,n(o)},void 0,e=>{console.error("載入 FBX 時發生錯誤:",e),o(e)})})}}var p=n(4968);const d=.5,w=.3,f=.1;var y=(0,i.pM)({__name:"BottomLayer",setup(e){const t=(0,r.KR)(null);let n,o,a,c,l,y=[],m=new s.Pq0(5.5,6.5,10),v=new s.Pq0(5.5,6.5,10),h={x:0,y:0},g=!1,x=new s.Pq0(0,0,0),A=!0;const k=new s.Pq0(5.5,15,10),b=new s.Pq0(0,5,2.5),P=[{type:"A",position:new s.Pq0(-2.5,0,-1.5),cameraPosition:new s.Pq0(-.5,4.5,7.5)},{type:"B",position:new s.Pq0(-2.5,0,4.5),cameraPosition:new s.Pq0(-2.5,6.5,12)},{type:"C",position:new s.Pq0(4,0,-1.5),cameraPosition:new s.Pq0(4,6.5,8)},{type:"D",position:new s.Pq0(5,0,4.5),cameraPosition:new s.Pq0(5,6.5,12)}],O=P.reduce((e,t)=>(e[t.type]={position:t.cameraPosition,lookAt:t.position},e),{});(0,i.sV)(()=>{z(),F()}),(0,i.xo)(()=>{window.removeEventListener("resize",S),window.removeEventListener("keydown",T),t.value?.removeEventListener("click",L),t.value?.removeEventListener("mousemove",E),a&&a.dispose(),p.Ay.killTweensOf(o.position),p.Ay.killTweensOf(x)});const z=async()=>{if(!t.value)return;c=new s.tBo,l=new s.I9Y,n=new s.Z58,n.background=new s.Q1f(15791352);let e=new u,i=new s.I9Y(t.value.clientWidth,t.value.clientHeight);o=e.createCamera(i,k),x.copy(b),a=e.createRenderer(i),t.value.appendChild(a.domElement),e.addLight(n),await j(e),q(),window.addEventListener("resize",S),window.addEventListener("keydown",T),t.value.addEventListener("click",L),t.value.addEventListener("mousemove",E)},q=()=>{A=!0,p.Ay.to(o.position,{x:m.x,y:m.y,z:m.z,duration:2,ease:"power2.out",onComplete:()=>{A=!1}}),p.Ay.to(x,{x:0,y:0,z:0,duration:2.5,ease:"power2.out"})},j=async e=>{const t=P.map(t=>e.createFBX(t.type,t.position)),o=await Promise.all(t);o.forEach(e=>{n.add(e),y.push(e)})},E=e=>{if(!t.value)return;if(A)return;const n=t.value.getBoundingClientRect(),o=(e.clientX-n.left)/n.width*2-1,i=-(e.clientY-n.top)/n.height*2+1,a=g?w:d;h.x=o*a,h.y=i*a},L=e=>{if(!t.value)return;if(A)return;const n=t.value.getBoundingClientRect();l.x=(e.clientX-n.left)/n.width*2-1,l.y=-(e.clientY-n.top)/n.height*2+1,c.setFromCamera(l,o);const i=c.intersectObjects(y,!0);if(i.length>0){let e=i[0].object;while(e.parent&&!e.userData.type)e=e.parent;C(e)}},C=e=>{const t=e.userData.type;console.log("點擊了:",t),_(t)},_=e=>{const t=O[e];t?(g=!0,v=t.position.clone(),p.Ay.killTweensOf(o.position),p.Ay.killTweensOf(x),p.Ay.to(o.position,{x:t.position.x,y:t.position.y,z:t.position.z,duration:1,ease:"power2.inOut"}),p.Ay.to(x,{x:t.lookAt.x,y:t.lookAt.y,z:t.lookAt.z,duration:1,ease:"power2.inOut"}),console.log(`相機鎖定到 Area ${e}`)):console.warn(`找不到 area ${e} 的相機配置`)},B=()=>{g=!1,p.Ay.killTweensOf(o.position),p.Ay.killTweensOf(x),p.Ay.to(o.position,{x:m.x,y:m.y,z:m.z,duration:1,ease:"power2.inOut"}),p.Ay.to(x,{x:0,y:0,z:0,duration:1,ease:"power2.inOut"}),console.log("相機解鎖,恢復到初始視角")},T=e=>{"Escape"===e.key&&g&&B()},F=()=>{if(requestAnimationFrame(F),!A){const e=g?v:m,t=e.x+h.x,n=e.y+h.y;o.position.x+=(t-o.position.x)*f,o.position.y+=(n-o.position.y)*f}o.lookAt(x),a.render(n,o)},S=()=>{if(!t.value)return;const e=t.value.clientWidth/t.value.clientHeight,n=10;o instanceof s.qUd&&(o.left=n*e/-2,o.right=n*e/2,o.top=n/2,o.bottom=n/-2,o.updateProjectionMatrix()),a.setSize(t.value.clientWidth,t.value.clientHeight)};return(e,n)=>((0,i.uX)(),(0,i.CE)("div",{ref_key:"container",ref:t,class:"container"},null,512))}}),m=n(1241);const v=(0,m.A)(y,[["__scopeId","data-v-dad41d2a"]]);var h=v,g=(0,i.pM)({name:"App",components:{BottomLayer:h}});const x=(0,m.A)(g,[["render",a]]);var A=x;(0,o.Ef)(A).mount("#ve-app")}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}n.m=e,function(){var e=[];n.O=function(t,o,i,a){if(!o){var r=1/0;for(u=0;u<e.length;u++){o=e[u][0],i=e[u][1],a=e[u][2];for(var s=!0,c=0;c<o.length;c++)(!1&a||r>=a)&&Object.keys(n.O).every(function(e){return n.O[e](o[c])})?o.splice(c--,1):(s=!1,a<r&&(r=a));if(s){e.splice(u--,1);var l=i();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[o,i,a]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,a,r=o[0],s=o[1],c=o[2],l=0;if(r.some(function(t){return 0!==e[t]})){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(c)var u=c(n)}for(t&&t(o);l<r.length;l++)a=r[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(u)},o=self["webpackChunkweb"]=self["webpackChunkweb"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],function(){return n(8490)});o=n.O(o)})();
//# sourceMappingURL=app.ba8c1d28.js.map